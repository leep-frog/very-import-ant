"use strict";var j=Object.create;var x=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var U=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),W=(e,t)=>{for(var n in t)x(e,n,{get:t[n],enumerable:!0})},D=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of N(t))!V.call(e,o)&&o!==n&&x(e,o,{get:()=>t[o],enumerable:!(r=P(t,o))||r.enumerable});return e};var R=(e,t,n)=>(n=e!=null?j($(e)):{},D(t||!e||!e.__esModule?x(n,"default",{value:e,enumerable:!0}):n,e)),L=e=>D(x({},"__esModule",{value:!0}),e);var O=U((oe,s)=>{var A={};A.__wbindgen_placeholder__=s.exports;var i,{TextEncoder:q,TextDecoder:B}=require("util"),f=0,h=null;function y(){return(h===null||h.byteLength===0)&&(h=new Uint8Array(i.memory.buffer)),h}var v=new q("utf-8"),J=typeof v.encodeInto=="function"?function(e,t){return v.encodeInto(e,t)}:function(e,t){let n=v.encode(e);return t.set(n),{read:e.length,written:n.length}};function p(e,t,n){if(n===void 0){let u=v.encode(e),a=t(u.length,1)>>>0;return y().subarray(a,a+u.length).set(u),f=u.length,a}let r=e.length,o=t(r,1)>>>0,c=y(),_=0;for(;_<r;_++){let u=e.charCodeAt(_);if(u>127)break;c[o+_]=u}if(_!==r){_!==0&&(e=e.slice(_)),o=n(o,r,r=_+e.length*3,1)>>>0;let u=y().subarray(o+_,o+r),a=J(e,u);_+=a.written,o=n(o,r,_,1)>>>0}return f=_,o}var w=null;function g(){return(w===null||w.buffer.detached===!0||w.buffer.detached===void 0&&w.buffer!==i.memory.buffer)&&(w=new DataView(i.memory.buffer)),w}function z(e){let t=i.__externref_table_alloc();return i.__wbindgen_export_4.set(t,e),t}function T(e,t){try{return e.apply(this,t)}catch(n){let r=z(n);i.__wbindgen_exn_store(r)}}var C=new B("utf-8",{ignoreBOM:!0,fatal:!0});C.decode();function l(e,t){return e=e>>>0,C.decode(y().subarray(e,e+t))}function m(e){return e==null}function E(e){let t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){let o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){let o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){let o=e.length,c="[";o>0&&(c+=E(e[0]));for(let _=1;_<o;_++)c+=", "+E(e[_]);return c+="]",c}let n=/\[object ([^\]]+)\]/.exec(toString.call(e)),r;if(n&&n.length>1)r=n[1];else return toString.call(e);if(r=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:r}s.exports.run=function(){i.run()};function b(e){let t=i.__wbindgen_export_4.get(e);return i.__externref_table_dealloc(e),t}var M=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>i.__wbg_workspace_free(e>>>0,1)),I=class{__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,M.unregister(this),t}free(){let t=this.__destroy_into_raw();i.__wbg_workspace_free(t,0)}static version(){let t,n;try{let r=i.workspace_version();return t=r[0],n=r[1],l(r[0],r[1])}finally{i.__wbindgen_free(t,n,1)}}constructor(t){let n=i.workspace_new(t);if(n[2])throw b(n[1]);return this.__wbg_ptr=n[0]>>>0,M.register(this,this.__wbg_ptr,this),this}static defaultSettings(){let t=i.workspace_defaultSettings();if(t[2])throw b(t[1]);return b(t[0])}check(t){let n=p(t,i.__wbindgen_malloc,i.__wbindgen_realloc),r=f,o=i.workspace_check(this.__wbg_ptr,n,r);if(o[2])throw b(o[1]);return b(o[0])}format(t){let n,r;try{let _=p(t,i.__wbindgen_malloc,i.__wbindgen_realloc),u=f,a=i.workspace_format(this.__wbg_ptr,_,u);var o=a[0],c=a[1];if(a[3])throw o=0,c=0,b(a[2]);return n=o,r=c,l(o,c)}finally{i.__wbindgen_free(n,r,1)}}format_ir(t){let n,r;try{let _=p(t,i.__wbindgen_malloc,i.__wbindgen_realloc),u=f,a=i.workspace_format_ir(this.__wbg_ptr,_,u);var o=a[0],c=a[1];if(a[3])throw o=0,c=0,b(a[2]);return n=o,r=c,l(o,c)}finally{i.__wbindgen_free(n,r,1)}}comments(t){let n,r;try{let _=p(t,i.__wbindgen_malloc,i.__wbindgen_realloc),u=f,a=i.workspace_comments(this.__wbg_ptr,_,u);var o=a[0],c=a[1];if(a[3])throw o=0,c=0,b(a[2]);return n=o,r=c,l(o,c)}finally{i.__wbindgen_free(n,r,1)}}parse(t){let n,r;try{let _=p(t,i.__wbindgen_malloc,i.__wbindgen_realloc),u=f,a=i.workspace_parse(this.__wbg_ptr,_,u);var o=a[0],c=a[1];if(a[3])throw o=0,c=0,b(a[2]);return n=o,r=c,l(o,c)}finally{i.__wbindgen_free(n,r,1)}}tokens(t){let n,r;try{let _=p(t,i.__wbindgen_malloc,i.__wbindgen_realloc),u=f,a=i.workspace_tokens(this.__wbg_ptr,_,u);var o=a[0],c=a[1];if(a[3])throw o=0,c=0,b(a[2]);return n=o,r=c,l(o,c)}finally{i.__wbindgen_free(n,r,1)}}};s.exports.Workspace=I;s.exports.__wbg_String_8f0eb39a4a4c2f66=function(e,t){let n=String(t),r=p(n,i.__wbindgen_malloc,i.__wbindgen_realloc),o=f;g().setInt32(e+4*1,o,!0),g().setInt32(e+4*0,r,!0)};s.exports.__wbg_buffer_6e1d53ff183194fc=function(e){return e.buffer};s.exports.__wbg_call_3114932863209ca6=function(){return T(function(e,t){return e.call(t)},arguments)};s.exports.__wbg_debug_347b3d1f33e1c28e=function(e){console.debug(e)};s.exports.__wbg_done_adfd3f40364def50=function(e){return e.done};s.exports.__wbg_entries_ce82e236f8300a53=function(e){return Object.entries(e)};s.exports.__wbg_error_2a6b93fdada7ff11=function(e){console.error(e)};s.exports.__wbg_error_7534b8e9a36f1ab4=function(e,t){let n,r;try{n=e,r=t,console.error(l(e,t))}finally{i.__wbindgen_free(n,r,1)}};s.exports.__wbg_fromCodePoint_12f8bccbf527a957=function(){return T(function(e){return String.fromCodePoint(e>>>0)},arguments)};s.exports.__wbg_get_68aa371864aa301a=function(e,t){return e[t>>>0]};s.exports.__wbg_get_92a4780a3beb5fe9=function(){return T(function(e,t){return Reflect.get(e,t)},arguments)};s.exports.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return e[t]};s.exports.__wbg_info_b6bd3cb6471c2b4c=function(e){console.info(e)};s.exports.__wbg_instanceof_ArrayBuffer_435fcead703e2827=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t};s.exports.__wbg_instanceof_Map_77fd223783fe0068=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t};s.exports.__wbg_instanceof_Uint8Array_9b67296cab48238f=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t};s.exports.__wbg_isArray_fcd559a3bcfde1e9=function(e){return Array.isArray(e)};s.exports.__wbg_isSafeInteger_4de146aa53f6e470=function(e){return Number.isSafeInteger(e)};s.exports.__wbg_iterator_7a20c20ce22add0f=function(){return Symbol.iterator};s.exports.__wbg_length_2e63ba34c4121df5=function(e){return e.length};s.exports.__wbg_length_e74df4881604f1d9=function(e){return e.length};s.exports.__wbg_log_d818ca3cab23fc77=function(e){console.log(e)};s.exports.__wbg_new_076cac58bb698dd4=function(){return new Object};s.exports.__wbg_new_0c28e72025e00594=function(){return new Array};s.exports.__wbg_new_23362fa370a0a372=function(e){return new Uint8Array(e)};s.exports.__wbg_new_3f616ed16821b4c5=function(){return new Map};s.exports.__wbg_new_4d81617a04bc1b5b=function(e,t){return new Error(l(e,t))};s.exports.__wbg_new_8a6f238a6ece86ea=function(){return new Error};s.exports.__wbg_next_c591766a7286b02a=function(){return T(function(e){return e.next()},arguments)};s.exports.__wbg_next_f387ecc56a94ba00=function(e){return e.next};s.exports.__wbg_set_1d975b42d95fd6c6=function(e,t,n){return e.set(t,n)};s.exports.__wbg_set_3f1d0b984ed272ed=function(e,t,n){e[t]=n};s.exports.__wbg_set_7b70226104a82921=function(e,t,n){e.set(t,n>>>0)};s.exports.__wbg_set_a1fb6291729caffb=function(e,t,n){e[t>>>0]=n};s.exports.__wbg_stack_0ed75d68575b0f3c=function(e,t){let n=t.stack,r=p(n,i.__wbindgen_malloc,i.__wbindgen_realloc),o=f;g().setInt32(e+4*1,o,!0),g().setInt32(e+4*0,r,!0)};s.exports.__wbg_value_30db1d77772f3236=function(e){return e.value};s.exports.__wbg_warn_a6963915e4da61f6=function(e){console.warn(e)};s.exports.__wbindgen_as_number=function(e){return+e};s.exports.__wbindgen_bigint_from_i64=function(e){return e};s.exports.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)};s.exports.__wbindgen_bigint_get_as_i64=function(e,t){let n=t,r=typeof n=="bigint"?n:void 0;g().setBigInt64(e+8*1,m(r)?BigInt(0):r,!0),g().setInt32(e+4*0,!m(r),!0)};s.exports.__wbindgen_boolean_get=function(e){let t=e;return typeof t=="boolean"?t?1:0:2};s.exports.__wbindgen_debug_string=function(e,t){let n=E(t),r=p(n,i.__wbindgen_malloc,i.__wbindgen_realloc),o=f;g().setInt32(e+4*1,o,!0),g().setInt32(e+4*0,r,!0)};s.exports.__wbindgen_error_new=function(e,t){return new Error(l(e,t))};s.exports.__wbindgen_in=function(e,t){return e in t};s.exports.__wbindgen_init_externref_table=function(){let e=i.__wbindgen_export_4,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)};s.exports.__wbindgen_is_bigint=function(e){return typeof e=="bigint"};s.exports.__wbindgen_is_function=function(e){return typeof e=="function"};s.exports.__wbindgen_is_object=function(e){let t=e;return typeof t=="object"&&t!==null};s.exports.__wbindgen_is_string=function(e){return typeof e=="string"};s.exports.__wbindgen_is_undefined=function(e){return e===void 0};s.exports.__wbindgen_jsval_eq=function(e,t){return e===t};s.exports.__wbindgen_jsval_loose_eq=function(e,t){return e==t};s.exports.__wbindgen_memory=function(){return i.memory};s.exports.__wbindgen_number_get=function(e,t){let n=t,r=typeof n=="number"?n:void 0;g().setFloat64(e+8*1,m(r)?0:r,!0),g().setInt32(e+4*0,!m(r),!0)};s.exports.__wbindgen_number_new=function(e){return e};s.exports.__wbindgen_string_get=function(e,t){let n=t,r=typeof n=="string"?n:void 0;var o=m(r)?0:p(r,i.__wbindgen_malloc,i.__wbindgen_realloc),c=f;g().setInt32(e+4*1,c,!0),g().setInt32(e+4*0,o,!0)};s.exports.__wbindgen_string_new=function(e,t){return l(e,t)};s.exports.__wbindgen_throw=function(e,t){throw new Error(l(e,t))};var G=require("path").join(__dirname,"ruff_wasm_bg.wasm"),H=require("fs").readFileSync(G),X=new WebAssembly.Module(H),K=new WebAssembly.Instance(X,A);i=K.exports;s.exports.__wasm=i;i.__wbindgen_start()});var ne={};W(ne,{activate:()=>ee,deactivate:()=>te});module.exports=L(ne);var d=R(require("vscode")),S=R(O()),Q=new S.Workspace({lint:{select:["F821"]}}),Y=/^Undefined name `(.+)`$/,Z=5;function k(){return{language:"python"}}function ee(e){let t=new F(e);e.subscriptions.push(d.languages.registerDocumentFormattingEditProvider(k(),t),d.languages.registerDocumentRangeFormattingEditProvider(k(),t),d.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("very-import-ant")&&t.reload(e)}))}var F=class{settings;constructor(t){this.settings=this.reloadSettings(t)}reload(t){this.settings=this.reloadSettings(t)}reloadSettings(t){let n=d.workspace.getConfiguration("very-import-ant"),r=n.get("autoImports",[]),o=new Map;for(let u of r)o.has(u.variable)?o.get(u.variable).push(u.import):o.set(u.variable,[u.import]);let c=n.get("onTypeTriggerCharacters","");this.settings?.onTypeRegistration&&this.settings.onTypeRegistration.dispose();let _=d.languages.registerOnTypeFormattingEditProvider(k(),this,c.at(0)||`
`,...c.slice(1));return t.subscriptions.push(_),{enabled:n.get("format.enable",!1),autoImports:o,onTypeRegistration:_}}provideDocumentFormattingEdits(t,n,r){return console.log("Formatting doc"),this.formatDocument(t)}provideDocumentRangeFormattingEdits(t,n,r,o){return console.log("Formatting range"),this.formatDocument(t)}provideDocumentRangesFormattingEdits(t,n,r,o){return console.log("Formatting ranges"),this.formatDocument(t)}provideOnTypeFormattingEdits(t,n,r,o,c){return console.log("Formatting on type"),this.formatDocument(t)}formatDocument(t){if(!this.settings.enabled){d.window.showErrorMessage("The Very Import-ant formatter is not enabled! Set `very-import-ant.format.enable` to true in your VS Code settings");return}let n=t.getText(),r=Q.check(n);console.log(`ruff diagnosticts: ${JSON.stringify(r)}`);let o=[...new Set(r.flatMap(_=>{let a=Y.exec(_.message)?.at(1);return a?this.settings.autoImports.get(a)||[]:_.message.startsWith("SyntaxError")?[]:(d.window.showErrorMessage(`Undefined variable could not be determined from error message (${JSON.stringify(_)})`),[])}))];if(!o.length)return;let c={edits:[],text:n};if(this.addImports(c,o),c.error){d.window.showErrorMessage(c.error);return}return c.edits.length<=1?c.edits.at(0):[{range:new d.Range(0,0,t.lineCount,0),newText:c.text}]}addImports(t,n){if(t.edits.length>Z){t.error="Formatting error (depth-limit). Please open a GitHub issue and include the contents of your file.";return}let r;try{r=new S.Workspace({lint:{select:["I001","I002"],isort:{"required-imports":n,"lines-after-imports":2,"combine-as-imports":!0}}})}catch(_){d.window.showErrorMessage(`Failed to create import config: ${_}`);return}let c=r.check(t.text).flatMap(_=>_.fix?.edits||[]).map(_=>({range:new d.Range(_.location.row-1,_.location.column-1,_.end_location.row-1,_.end_location.column-1),newText:_.content||""}));c.length&&(console.log(`Adding edits: ${JSON.stringify(c)}`),t.text=this.applyEdits(t.text,c),t.edits.push(c),this.addImports(t,n))}applyEdits(t,n){return n.reduce((r,o)=>this.applyEdit(r,o),t)}applyEdit(t,n){let r=t.split(`
`);r.slice(0,n.range.start.line).push(r[n.range.start.line].slice(0,n.range.start.character));let c=[];return n.range.start.line>0&&c.push(r.slice(0,n.range.start.line).join(`
`),`
`),c.push(r[n.range.start.line+1].slice(0,n.range.start.character),n.newText,r[n.range.end.line].slice(n.range.end.character)),n.range.end.line+1<r.length&&c.push(`
`,r.slice(n.range.end.line+1).join(`
`)),c.join("")}};function te(){}0&&(module.exports={activate,deactivate});
